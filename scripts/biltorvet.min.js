function Biltorvet(t){var r=t(document).find(".bdt .vehicle_search"),a=t(document).find(".bdt .vehicle_search_results"),i="",d=document.getElementById("frontpage_vehicle_search"),c=document.getElementById("vehicle_search_frontpage_button"),n=null,e=r.find(".lds-ring"),p=null,l=null,u=null,m=null,v=!1,o={CompanyIds:null,Propellant:null,Makes:null,Models:null,BodyTypes:null,ProductTypes:null,PriceMin:null,PriceMax:null,ConsumptionMin:null,ConsumptionMax:null,Start:null,Limit:null,OrderBy:null,Ascending:null,BrandNew:null};if(d&&(i=document.getElementById("root_url").textContent),0<r.length&&r.data("makeids")){p=[];var s=r.data("makeids");if(isNaN(s))for(var f in s.split(","))p.push(parseInt(s.split(",")[f]));else p.push(s);l={MakeIds:p}}function y(){h(),t.ajax({url:ajax_config.ajax_url,method:"POST",dataType:"json",data:{action:"save_filter",filter:o},cache:!1,success:function(e){!function(e,n){var t=window.location.pathname,l=t,a=t.split("/");for(var i in e)if("Models"==i||"Makes"==i){var o=e[i];Array.isArray(e[i])&&(o=e[i].shift()),l=b(a,i,o)}window.history.pushState(null,null,l.replace("+","%2B")),n()}(o,function(){window.location.reload()})},complete:function(){M()}})}function b(e,n,t){var l="";switch(n){case"Makes":e[3]=t;break;case"Models":e[4]=t}""===e[2]?e[2]=1:""!=e[2]&&(e[2]=1),d&&(e[1]=i,e[2]=1);for(var a=1;a<e.length;a++)null!==e[a]&&(l+="/"+e[a]);return d&&(l=l.substr(1)),l}function h(){e.hasClass("d-none")&&e.css("opacity",0).css("display","block").removeClass("d-none"),e.animate({opacity:1},1e3)}function M(){e.animate({opacity:0},200,function(){t(this).css("display","none").addClass("d-none")})}function g(){var e=u.data("slider").getValue()[0];e=-1===e?null:e;var n=u.data("slider").getValue()[1];n=-1===n?null:n;var t=m.data("slider").getValue()[0];t=-1===t?null:t;var l=m.data("slider").getValue()[1];l=-1===l?null:l,o={CompanyIds:""===r.find("select[name=company]").val()?null:[r.find("select[name=company]").val()],Propellants:""===r.find("select[name=propellant]").val()?null:[r.find("select[name=propellant]").val()],Makes:""===r.find("select[name=make]").val()?null:[r.find("select[name=make]").val()],Models:""===r.find("select[name=model]").val()?null:[r.find("select[name=model]").val()],BodyTypes:""===r.find("select[name=bodyType]").val()?null:[r.find("select[name=bodyType]").val()],ProductTypes:""===r.find("select[name=productType]").val()?null:[r.find("select[name=productType]").val()],PriceMin:null!==u&&u.data("slider").getAttribute("min")!==e?e:null,PriceMax:null!==u&&u.data("slider").getAttribute("max")!==n?n:null,ConsumptionMin:null!==m&&m.data("slider").getAttribute("min")!==t?t:null,ConsumptionMax:null!==m&&m.data("slider").getAttribute("max")!==l?l:null,Start:null,Limit:null,OrderBy:""===a.find("select[name=orderBy]").val()?null:a.find("select[name=orderBy]").val(),Ascending:"asc"===a.find("select[name=ascDesc]").val(),BrandNew:null}}this.Init=function(){if(t.bootstrapSlider&&(v=!0),0<t("#priceRange").length){var e={id:t(this).attr("id"),min:100,max:1e7,range:!0,value:[1e3,1e7],step:1,tooltip:"hide"};u=v?t("#priceRange").bootstrapSlider(e):t("#priceRange").slider(e)}if(0<t("#consumptionRange").length){var n={id:t(this).attr("id"),min:0,max:10,range:!0,value:[0,10],step:1,tooltip:"hide"};m=v?t("#consumptionRange").bootstrapSlider(n):t("#consumptionRange").slider(n)}this.ReloadUserFilterSelection(!0)},this.ReloadUserFilterSelection=function(e){0<r.length&&(null!==n&&n.abort(),h(),g(),function(){v?(m.bootstrapSlider("disable"),u.bootstrapSlider("disable")):(m.slider("disable"),u.slider("disable"));r.find("select").prop("disabled",!0)}(),n=t.ajax({url:ajax_config.ajax_url,method:"POST",dataType:"json",data:{action:"get_filter_options",filter:e?l:o},cache:!1,success:function(e){var n="";for(var t in e.companies)n+='<option value="'+e.companies[t].key+'">'+e.companies[t].value+"</option>";r.find("select[name=company]").find("option:not(:first-child)").remove().end().append(n),""!==n&&r.find("select[name=company]").removeAttr("disabled");var l="";for(var t in e.makes)null!==p&&-1===p.indexOf(e.makes[t].id)||(l+='<option value="'+e.makes[t].name+'">'+e.makes[t].name+"</option>");r.find("select[name=make]").find("option:not(:first-child)").remove().end().append(l),""!==l&&r.find("select[name=make]").removeAttr("disabled");var a="";for(var t in e.models)a+='<option value="'+e.models[t].name+'">'+e.models[t].name+"</option>";r.find("select[name=model]").find("option:not(:first-child)").remove().end().append(a),""!==a&&r.find("select[name=model]").removeAttr("disabled");var i="";for(var t in e.propellants)i+='<option value="'+e.propellants[t].name+'">'+e.propellants[t].name+"</option>";r.find("select[name=propellant]").find("option:not(:first-child)").remove().end().append(i),""!==i&&r.find("select[name=propellant]").removeAttr("disabled");var o="";for(var t in e.bodyTypes)o+='<option value="'+e.bodyTypes[t].name+'">'+e.bodyTypes[t].name+"</option>";r.find("select[name=bodyType]").find("option:not(:first-child)").remove().end().append(o),""!==o&&r.find("select[name=bodyType]").removeAttr("disabled");var s="";for(var t in e.productTypes)s+='<option value="'+e.productTypes[t].name+'">'+e.productTypes[t].name+"</option>";r.find("select[name=productType]").find("option:not(:first-child)").remove().end().append(s),""!==s&&r.find("select[name=productType]").removeAttr("disabled"),d?(c.setAttribute("data-labelpattern","Vis "+e.totalResults+" resultater"),c.innerText="Vis "+e.totalResults+" resultater"):r.find(".search").text(r.find(".search").data("labelpattern").replace("%u",e.totalResults)),null!==m&&(v?m.bootstrapSlider(e.consumptionMin===e.consumptionMax?"disable":"enable"):m.slider(e.consumptionMin===e.consumptionMax?"disable":"enable")).data("slider").setAttribute("min",e.consumptionMin).setAttribute("max",e.consumptionMax).setValue([null===e.values.consumptionMin?e.consumptionMin:e.values.consumptionMin,null===e.values.consumptionMax?e.consumptionMax:e.values.consumptionMax],!0,!0);null!==u&&(v?u.bootstrapSlider(e.priceMin===e.priceMax?"disable":"enable"):u.slider(e.priceMin===e.priceMax?"disable":"enable")).data("slider").setAttribute("min",e.priceMin).setAttribute("max",e.priceMax).setValue([null===e.values.priceMin?e.priceMin:e.values.priceMin,null===e.values.priceMax?e.priceMax:e.values.priceMax],!0,!0);e.values&&(e.values.companyIds&&e.values.companyIds[0]&&r.find('select[name=company] option[value="'+e.values.companyIds[0]+'"]').prop("selected",!0),e.values.makes&&e.values.makes[0]&&r.find('select[name=make] option[value="'+e.values.makes[0]+'"]').prop("selected",!0),e.values.models&&e.values.models[0]&&r.find('select[name=model] option[value="'+e.values.models[0]+'"]').prop("selected",!0),e.values.propellants&&e.values.propellants[0]&&r.find('select[name=propellant] option[value="'+e.values.propellants[0]+'"]').prop("selected",!0),e.values.bodyTypes&&e.values.bodyTypes[0]&&r.find('select[name=bodyType] option[value="'+e.values.bodyTypes[0]+'"]').prop("selected",!0),e.values.productTypes&&e.values.productTypes[0]&&r.find('select[name=productType] option[value="'+e.values.productTypes[0]+'"]').prop("selected",!0))},complete:function(){n=null,M()}}))},this.SaveUserFilterSettings=function(){h(),g(),y()},this.ResetFilter=function(){h(),o=null;var e=window.location.pathname.split("/");window.history.replaceState(null,null,"/"+e[1]),y()},this.Init()}function FormatPrice(e,n){return-1===e?e:e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")+(n?",-":"")}jQuery(function(l){var n=new Biltorvet(l);l(document).on("change",".bdtSlider",function(e){var n=e.value.newValue[0],t=e.value.newValue[1];"priceRange"===l(e.target).attr("id")&&(n=FormatPrice(n,!1),t=FormatPrice(t,!0)),-1===n&&(n=""),-1===t&&(t=""),l(this).closest(".bdtSliderContainer").find(".bdtSliderMinVal").text(n).end().find(".bdtSliderMaxVal").text(t)}).on("slideStop",".bdtSlider",function(e){n.ReloadUserFilterSelection(!1)}).on("click",".bdt .reset",function(e){e.preventDefault(),l(this).closest(".bdt .vehicle_search").find("select").val(""),n.ResetFilter()}).on("click",".bdt .search",function(e){e.preventDefault(),n.SaveUserFilterSettings()}).on("change",".bdt .vehicle_search_results",function(){n.SaveUserFilterSettings()}).on("change",".bdt .vehicle_search select",function(){var e=l(this).closest(".bdt .vehicle_search");"make"===l(this).attr("name")&&e.find("select[name=model]").val("").trigger("change"),"model"===l(this).attr("name")&&(e.find("select[name=bodyType]").val(""),e.find("select[name=productType]").val(""),e.find("select[name=propellant]").val(""),e.find("select[name=priceMinMax]").val(""),e.find("select[name=priceMinMax]").val(""),e.find("select[name=consumptionMin]").val(""),e.find("select[name=consumptionMax]").val("")),n.ReloadUserFilterSelection(!1)})});